<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="seo-title">Статья - CyberThreat Explorer</title>
    <meta id="seo-description" name="description" content="Образовательная статья по кибербезопасности">
    <link rel="canonical" href="https://cosmic-muffin-c25b06.netlify.app/article.html">
    <meta property="og:type" content="article">
    <meta property="og:title" id="og-title" content="Статья | CyberThreat Explorer">
    <meta property="og:description" id="og-description" content="Образовательная статья">
    <meta property="og:image" content="https://cosmic-muffin-c25b06.netlify.app/assets/img/logos/icon.svg">
    <meta property="og:site_name" content="CyberThreat Explorer">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="Статья | CyberThreat Explorer">
    <meta name="twitter:description" id="twitter-description" content="Образовательная статья">
    <meta name="twitter:image" content="https://cosmic-muffin-c25b06.netlify.app/assets/img/logos/icon.svg">
    <script type="application/ld+json" id="schema-article">{"@context":"https://schema.org","@type":"Article","headline":"Статья","publisher":{"@type":"Organization","name":"CyberThreat Explorer"}}</script>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/map.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/brands.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css" crossorigin="anonymous">
    <link rel="icon" type="image/svg+xml" href="assets/img/logos/icon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="assets/img/logos/icon.svg">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .article-container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .article-header { text-align: center; margin-bottom: 40px; padding: 30px; background: rgba(30, 41, 59, 0.5); border-radius: 16px; border: 1px solid rgba(59, 130, 246, 0.2); }
        .article-header h1 { font-size: 2rem; color: #f8fafc; margin-bottom: 15px; }
        .article-header p { color: #94a3b8; font-size: 1.1rem; }
        .article-content { background: rgba(30, 41, 59, 0.5); border-radius: 16px; padding: 40px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .article-content h2 { color: #3b82f6; font-size: 1.5rem; margin: 30px 0 15px; }
        .article-content h3 { color: #60a5fa; font-size: 1.2rem; margin: 25px 0 10px; }
        .article-content p { color: #cbd5e1; line-height: 1.8; margin-bottom: 15px; }
        .article-content ul, .article-content ol { color: #cbd5e1; margin: 15px 0; padding-left: 25px; }
        .article-content li { margin-bottom: 8px; }
        .article-content code { background: rgba(15, 23, 42, 0.6); padding: 2px 8px; border-radius: 4px; font-family: 'Roboto Mono', monospace; }
        .article-content pre { background: rgba(15, 23, 42, 0.8); padding: 20px; border-radius: 12px; overflow-x: auto; margin: 20px 0; }
        .article-content pre code { background: none; padding: 0; }
        .article-content strong { color: #60a5fa; }
        .warning-box { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .warning-box h4 { color: #ef4444; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .info-box { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .info-box h4 { color: #3b82f6; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .success-box { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .success-box h4 { color: #10b981; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .loading-spinner { display: flex; flex-direction: column; align-items: center; padding: 60px; color: #94a3b8; }
        .loading-spinner i { font-size: 3rem; color: #3b82f6; margin-bottom: 20px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .back-link { display: inline-flex; align-items: center; gap: 8px; color: #3b82f6; text-decoration: none; margin-bottom: 20px; font-size: 0.95rem; transition: all 0.3s; }
        .back-link:hover { color: #60a5fa; transform: translateX(-5px); }
        .test-section { background: rgba(30, 41, 59, 0.7); border-radius: 16px; padding: 30px; margin: 40px 0; border: 1px solid rgba(59, 130, 246, 0.3); }
        .test-section h3 { color: #f8fafc; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .quiz-option { display: flex; padding: 14px 18px; background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s; }
        .quiz-option:hover { border-color: rgba(59, 130, 246, 0.5); background: rgba(59, 130, 246, 0.1); }
        .quiz-option.correct { border-color: #10b981; background: rgba(16, 185, 129, 0.15); }
        .quiz-option.incorrect { border-color: #ef4444; background: rgba(239, 68, 68, 0.15); }
        .quiz-option label { cursor: pointer; width: 100%; color: #cbd5e1; }
        .quiz-explanation { display: none; padding: 15px; border-radius: 10px; margin-top: 15px; }
        .quiz-explanation.show { display: block; }
        .quiz-explanation.correct { background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; color: #34d399; }
        .quiz-explanation.incorrect { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #fca5a5; }
        .lesson-nav { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .lesson-nav a { display: flex; align-items: center; gap: 10px; padding: 12px 20px; background: rgba(30, 41, 59, 0.6); border-radius: 10px; color: #cbd5e1; text-decoration: none; transition: all 0.3s; }
        .lesson-nav a:hover { background: rgba(59, 130, 246, 0.2); color: #f8fafc; }
        .lesson-nav a.disabled { opacity: 0.5; pointer-events: none; }
        @media (max-width: 768px) {
            .article-content { padding: 24px; }
            .article-content h2 { font-size: 1.3rem; }
            .article-content h3 { font-size: 1.1rem; }
            .lesson-nav { flex-direction: column; gap: 12px; }
            .lesson-nav a { justify-content: center; }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>CyberThreat<span>Explorer</span></h1>
                <small>для начинающих</small>
            </a>
            
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html"><i class="fas fa-map"></i> Карта атак</a></li>
                    <li><a href="glossary.html"><i class="fas fa-book"></i> Глоссарий</a></li>
                    <li><a href="learn.html"><i class="fas fa-graduation-cap"></i> Учебник</a></li>
                    <li><a href="about.html"><i class="fas fa-info-circle"></i> О проекте</a></li>
                </ul>
            </nav>
            
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <main class="container main-content article-container">
        <a href="learn.html" class="back-link"><i class="fas fa-arrow-left"></i> Вернуться к учебнику</a>
        <div class="article-header">
            <h1 id="article-title">Загрузка...</h1>
            <p id="article-description"></p>
        </div>
        <div id="article-content" class="article-content">
            <div class="loading-spinner">
                <i class="fas fa-spinner"></i>
                <p>Загрузка статьи...</p>
            </div>
        </div>
        <div id="lesson-nav" class="lesson-nav" style="display: none;">
            <a id="prev-lesson" href="#"><i class="fas fa-chevron-left"></i> Предыдущий урок</a>
            <a id="next-lesson" href="#">Следующий урок <i class="fas fa-chevron-right"></i></a>
        </div>
    </main>
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section"><h4><i class="fas fa-graduation-cap"></i> Обучение</h4><p>Изучай кибербезопасность с интерактивной картой атак</p></div>
                <div class="footer-section"><h4><i class="fas fa-book"></i> Ресурсы</h4><p>Глоссарий терминов и обучающие уроки</p></div>
                <div class="footer-section"><h4><i class="fas fa-code"></i> Технологии</h4><p>D3.js • JavaScript • HTML5 • CSS3</p></div>
            </div>
            <div class="footer-bottom"><p>&copy; 2026 CyberThreat Explorer | Образовательный проект</p></div>
        </div>
    </footer>
    <script src="assets/js/progressManager.js"></script>
    <script>
        // Все доступные уроки (отсортированы по порядку в учебнике)
        const allLessons = [
            // Глава 1: Основы безопасности
            'what-is-ddos', 'what-is-phishing', 'how-vpn-works', 'how-passwords-work', 'malware-guide',
            'social-engineering', 'social-media-safety', 'wifi-security', 'email-security', 'updates-importance',
            // Глава 2: Продвинутая защита
            'encryption-basics', 'mobile-security', 'two-factor-auth', 'phishing-attacks-deep-dive', 'crypto-security',
            'iot-security', 'gaming-security', 'child-safety', 'backup-guide', 'online-anonymity',
            // Глава 3: Теория информационной безопасности
            'tib-intro', 'tib-info-object', 'tib-threats', 'tib-vulnerabilities', 'tib-intruder-model',
            'tib-threat-modeling', 'tib-security-policies', 'tib-discretionary', 'tib-mandatory', 'tib-integrity', 'tib-nsd',
            // Глава 4: Безопасность на практике
            'security-architecture', 'cryptography-fundamentals', 'vulnerability-management', 
            'threat-modeling-practical', 'network-security-monitoring', 'endpoint-detection-response',
            'security-automation-orchestration', 'secops-fundamentals', 'security-auditing-compliance',
            // Глава 5: Анализ и расследование
            'advanced-malware-analysis', 'advanced-memory-forensics', 'advanced-threat-intelligence', 
            'advanced-incident-response', 'advanced-reverse-engineering',
            // Глава 6: Тестирование и аудит
            'advanced-red-teaming', 'advanced-web-testing', 'advanced-cloud-security', 
            'advanced-exploitation-techniques', 'advanced-ics-security',
            // Глава 7: Этичный хакинг и пентестинг
            'ethical-hacking-intro', 'pentesting-methodology', 'reconnaissance', 
            'scanning-enumeration', 'vulnerability-assessment', 'exploitation-techniques',
            'post-exploitation', 'reporting-documentation', 'legal-ethics', 'tools-frameworks'
        ];

        const builtInArticles = {
            'what-is-ddos': {
                title: 'Что такое DDoS-атака?',
                description: 'Подробное объяснение DDoS-атак, их видов и способов защиты.',
                content: `<h2>Введение в DDoS-атаки</h2>
                <p>DDoS-атака (Distributed Denial of Service) — это кибератака, при которой злоумышленник пытается сделать веб-сайт недоступным, перегружая его трафиком.</p>
                <div class="info-box"><h4><i class="fas fa-info-circle"></i> Факт</h4><p>Самые мощные DDoS-атаки могут достигать нескольких терабит в секунду!</p></div>
                <h2>Виды DDoS-атак</h2>
                <h3>1. Объёмные атаки</h3>
                <p>Злоумышленник заполняет канал связи жертвы огромным количеством данных.</p>
                <h3>2. Протокольные атаки</h3>
                <p>Атаки направлены на истощение ресурсов сервера через уязвимости в протоколах.</p>
                <h3>3. Атаки на уровень приложений</h3>
                <p>Злоумышленник имитирует поведение обычных пользователей в больших масштабах.</p>
                <h2>Как защититься</h2>
                <div class="success-box"><h4><i class="fas fa-check-circle"></i> Методы защиты</h4>
                <ul>
                    <li>Использование CDN</li>
                    <li>Настройка firewall</li>
                    <li>Мониторинг трафика</li>
                    <li>Rate limiting</li>
                </ul>
                </div>`,
                quiz: [
                    {question: 'Что означает DDoS?', options: ['Digital Denial of Service', 'Distributed Denial of Service', 'Direct Denial of Service'], correct: 1, explanation: 'DDoS = Distributed Denial of Service.'},
                    {question: 'Какой тип атак направлен на протоколы?', options: ['Volumetric', 'Protocol', 'Application'], correct: 1, explanation: 'Protocol Attacks используют уязвимости в протоколах.'}
                ]
            },
            'what-is-phishing': {
                title: 'Фишинг: как распознать и защититься',
                description: 'Узнайте о фишинговых атаках и способах защиты.',
                content: `<h2>Что такое фишинг?</h2>
                <p>Фишинг — это вид интернет-мошенничества, при котором злоумышленники получают конфиденциальные данные, маскируясь под надёжные источники.</p>
                <div class="info-box"><h4><i class="fas fa-info-circle"></i> Этимология</h4><p>Слово "фишинг" от английского "fishing" — рыбалка.</p></div>
                <h2>Виды фишинга</h2>
                <ul>
                    <li><strong>Email фишинг</strong> — массовые письма от банков и сервисов</li>
                    <li><strong>Вишинг</strong> — через телефонные звонки</li>
                    <li><strong>Смишинг</strong> — через SMS</li>
                </ul>
                <h2>Как распознать</h2>
                <div class="warning-box"><h4><i class="fas fa-exclamation-triangle"></i> Признаки мошенничества</h4>
                <ul>
                    <li>Срочность и давление</li>
                    <li>Ссылка на подозрительный домен</li>
                    <li>Грамматические ошибки</li>
                </ul>
                </div>
                <h2>Как защититься</h2>
                <div class="success-box"><h4><i class="fas fa-check-circle"></i> Правила</h4>
                <ul>
                    <li>Не переходите по подозрительным ссылкам</li>
                    <li>Проверяйте адрес сайта</li>
                    <li>Включите 2FA</li>
                </ul>
                </div>`,
                quiz: [
                    {question: 'Что такое вишинг?', options: ['Фишинг через email', 'Фишинг через звонки', 'Фишинг через SMS'], correct: 1, explanation: 'Вишинг — это звонки от мошенников.'}
                ]
            }
        };

        // Тесты для уроков Главы 7
        const chapter7Quizzes = {
            // Тест после урока 3 (Разведка и сбор информации)
            'after-lesson-3': {
                title: 'Тест по теме: Разведка и сбор информации',
                description: 'Проверьте свои знания по методам сбора информации о цели',
                questions: [
                    {question: 'Какой тип разведки не требует прямого контакта с целью?', options: ['Активная разведка', 'Пассивная разведка', 'Социальная инженерия', 'Физическая разведка'], correct: 1, explanation: 'Пассивная разведка использует только открытые источники и не взаимодействует напрямую с целью.'},
                    {question: 'Какой инструмент используется для поиска поддоменов?', options: ['Nmap', 'theHarvester', 'Metasploit', 'Burp Suite'], correct: 1, explanation: 'theHarvester используется для сбора email и поддоменов из открытых источников.'},
                    {question: 'Что такое OSINT?', options: ['Open Source Intelligence', 'Operating System Intelligence', 'Online Security Investigation', 'Open System Interface'], correct: 0, explanation: 'OSINT — это сбор информации из открытых публичных источников.'},
                    {question: 'Какой командой в Nmap можно определить версии сервисов?', options: ['nmap -sS', 'nmap -sV', 'nmap -O', 'nmap -A'], correct: 1, explanation: 'Опция -sV (service version) определяет версии запущенных сервисов.'},
                    {question: 'Что показывает команда Whois?', options: ['Открытые порты', 'Информацию о домене и владельце', 'Сетевой маршрут', 'Содержимое файлов'], correct: 1, explanation: 'Whois предоставляет регистрационную информацию о домене.'}
                ]
            },
            // Комбинированный тест после урока 7 (уроки 4, 5, 6, 7)
            'after-lesson-7': {
                title: 'Комплексный тест: Сканирование, Оценка уязвимостей, Эксплуатация, Пост-эксплуатация',
                description: 'Проверьте знания по 4 урокам: Сканирование, Уязвимости, Эксплуатация, Пост-эксплуатация',
                questions: [
                    // Урок 4: Сканирование и энумерация
                    {question: 'Какой тип сканирования Nmap является наиболее скрытным?', options: ['TCP Connect (-sT)', 'SYN Scan (-sS)', 'UDP Scan (-sU)', 'ACK Scan (-sA)'], correct: 1, explanation: 'SYN scan (-sS) отправляет только SYN пакет и не устанавливает полное соединение, что делает его более скрытным.'},
                    {question: 'Что такое энумерация?', options: ['Сканирование портов', 'Процесс обнаружения и идентификации сетевых ресурсов и сервисов', 'Шифрование данных', 'Монтирование дисков'], correct: 1, explanation: 'Энумерация — это систематический процесс обнаружения и идентификации ресурсов в сети.'},
                    {question: 'Какой порт по умолчанию использует SSH?', options: ['21', '22', '80', '443'], correct: 1, explanation: 'SSH по умолчанию работает на порту 22.'},
                    {question: 'Какой инструмент лучше подходит для сканирования веб-приложений?', options: ['Nmap', 'OWASP ZAP', 'Ping', 'Tracert'], correct: 1, explanation: 'OWASP ZAP — специализированный инструмент для тестирования веб-приложений.'},
                    // Урок 5: Оценка уязвимостей
                    {question: 'Что означает аббревиатура CVSS?', options: ['Common Vulnerability Scoring System', 'Computer Virus Security Standard', 'Cyber Attack Vulnerability Score', 'Computer Vulnerability Status System'], correct: 0, explanation: 'CVSS — это стандартная система оценки критичности уязвимостей.'},
                    {question: 'Какой уровень критичности имеет CVSS score 9.0?', options: ['Средний', 'Высокий', 'Критический', 'Низкий'], correct: 2, explanation: 'CVSS 9.0-10.0 классифицируется как Critical (Критический).'},
                    {question: 'Какой тип уязвимости позволяет внедрять SQL-запросы?', options: ['XSS', 'CSRF', 'SQL Injection', 'RCE'], correct: 2, explanation: 'SQL Injection позволяет внедрять произвольные SQL-запросы в базу данных.'},
                    {question: 'Какой инструмент используется для автоматической эксплуатации SQL-инъекций?', options: ['Metasploit', 'SQLMap', 'Nmap', 'Nikto'], correct: 1, explanation: 'SQLMap — специализированный инструмент для эксплуатации SQL-инъекций.'},
                    // Урок 6: Техники эксплуатации
                    {question: 'Что такое RCE?', options: ['Remote Code Execution', 'Remote Computer Endpoint', 'Reduced Code Efficiency', 'Random Code Execution'], correct: 0, explanation: 'RCE — это возможность удалённого выполнения кода на целевой системе.'},
                    {question: 'Какой тип SQL-инъекции использует оператор UNION?', options: ['Error-based', 'Union-based', 'Boolean-based', 'Time-based'], correct: 1, explanation: 'Union-based SQLi использует оператор UNION для извлечения данных из других таблиц.'},
                    {question: 'Какой эксплойт использовался для уязвимости EternalBlue?', options: ['Apache', 'SMB', 'SSH', 'DNS'], correct: 1, explanation: 'EternalBlue — это эксплойт для уязвимости в протоколе SMB (CVE-2017-0144).'},
                    {question: 'Что такое LPE?', options: ['Local Program Execution', 'Low Priority Error', 'Local Privilege Escalation', 'Log Password Extraction'], correct: 2, explanation: 'LPE — это повышение привилегий до уровня локального администратора или root.'},
                    // Урок 7: Пост-эксплуатация
                    {question: 'Что такое пост-эксплуатация?', options: ['Первичный взлом системы', 'Этап после получения первоначального доступа для закрепления и продвижения', 'Восстановление системы', 'Установка антивируса'], correct: 1, explanation: 'Пост-эксплуатация включает действия после успешного проникновения: закрепление, повышение привилегий, продвижение по сети.'},
                    {question: 'Какой файл в Linux хранит хешированные пароли?', options: ['/etc/passwd', '/etc/shadow', '/etc/hosts', '/etc/groups'], correct: 1, explanation: '/etc/shadow содержит хешированные пароли и может быть прочитан только с правами root.'},
                    {question: 'Что такое persistence (закрепление)?', options: ['Увеличение скорости системы', 'Сохранение доступа к системе после перезагрузки', 'Очистка логов', 'Резервное копирование'], correct: 1, explanation: 'Закрепление (persistence) — это механизмы для сохранения доступа к системе после перезагрузки.'},
                    {question: 'Какой инструмент используется для анализа Active Directory?', options: ['Mimikatz', 'BloodHound', 'SQLMap', 'Nmap'], correct: 1, explanation: 'BloodHound используется для визуализации и анализа связей в Active Directory.'}
                ]
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const articleId = urlParams.get('id') || 'what-is-ddos';

        function updateSEO(article) {
            const fullTitle = article.title + ' — CyberThreat Explorer';
            document.title = fullTitle;
            document.getElementById('seo-title').textContent = fullTitle;
            document.getElementById('og-title').setAttribute('content', fullTitle);
            document.getElementById('twitter-title').setAttribute('content', fullTitle);
            document.getElementById('seo-description').setAttribute('content', article.description);
            document.getElementById('og-description').setAttribute('content', article.description);
            document.getElementById('twitter-description').setAttribute('content', article.description);
            const schema = {"@context":"https://schema.org","@type":"Article","headline":article.title,"description":article.description,"publisher":{"@type":"Organization","name":"CyberThreat Explorer"}};
            document.getElementById('schema-article').textContent = JSON.stringify(schema);
        }

        function updateLessonNav(currentIndex) {
            const nav = document.getElementById('lesson-nav');
            const prevLink = document.getElementById('prev-lesson');
            const nextLink = document.getElementById('next-lesson');
            
            if (currentIndex > 0) {
                prevLink.href = 'article.html?id=' + allLessons[currentIndex - 1];
                prevLink.classList.remove('disabled');
            } else {
                prevLink.classList.add('disabled');
            }
            
            if (currentIndex < allLessons.length - 1) {
                nextLink.href = 'article.html?id=' + allLessons[currentIndex + 1];
                nextLink.classList.remove('disabled');
            } else {
                nextLink.classList.add('disabled');
            }
            
            nav.style.display = 'flex';
        }

        async function loadMarkdownArticle(id) {
            const cacheKey = 'article_' + id;
            const cached = localStorage.getItem(cacheKey);
            
            if (cached) {
                try {
                    const data = JSON.parse(cached);
                    // Проверяем, не устарел ли кэш (7 дней)
                    if (Date.now() - data.timestamp < 7 * 24 * 60 * 60 * 1000) {
                        console.log('Загружено из кэша:', id);
                        return data;
                    }
                } catch(e) {}
            }
            
            console.log('Попытка загрузить статью:', 'articles/' + id + '.md');
            
            try {
                const response = await fetch('articles/' + id + '.md');
                console.log('Ответ fetch:', response.status, response.statusText);
                
                if (!response.ok) throw new Error('Article not found: ' + response.status);
                
                const markdown = await response.text();
                console.log('Markdown загружен, длина:', markdown.length);
                
                // Извлекаем заголовок из markdown
                const titleMatch = markdown.match(/^# (.+)$/m);
                const title = titleMatch ? titleMatch[1] : id;
                console.log('Заголовок статьи:', title);
                
                // Конвертируем markdown в HTML
                const htmlContent = marked.parse(markdown);
                console.log('HTML сгенерирован, длина:', htmlContent.length);
                
                const data = {
                    title: title,
                    description: 'Урок по кибербезопасности: ' + title,
                    content: htmlContent,
                    timestamp: Date.now()
                };
                
                // Кэшируем
                localStorage.setItem(cacheKey, JSON.stringify(data));
                console.log('Статья закэширована');
                
                return data;
            } catch (error) {
                console.error('Error loading article:', error);
                return null;
            }
        }

        async function loadArticle() {
            console.log('=== НАЧАЛО ЗАГРУЗКИ СТАТЬИ ===');
            console.log('Запрошенная статья:', articleId);
            
            const currentIndex = allLessons.indexOf(articleId);
            console.log('Индекс в списке уроков:', currentIndex);
            
            // Проверяем, загружена ли библиотека marked
            if (typeof marked === 'undefined') {
                console.error('Библиотека marked.js не загружена!');
                document.getElementById('article-content').innerHTML = '<div class="warning-box"><h4>Ошибка</h4><p>Не удалось загрузить библиотеку marked.js. Проверьте подключение к интернету.</p></div>';
                return;
            }
            console.log('Библиотека marked.js загружена:', typeof marked);
            
            // Сначала пробуем загрузить встроенные статьи
            if (builtInArticles[articleId]) {
                console.log('Найдена встроенная статья');
                const article = builtInArticles[articleId];
                updateSEO(article);
                document.getElementById('article-title').textContent = article.title;
                document.getElementById('article-description').textContent = article.description;
                document.getElementById('article-content').innerHTML = article.content;
                if (article.quiz) renderQuiz(article.quiz);
                markLessonAsViewed(articleId);
                if (currentIndex >= 0) updateLessonNav(currentIndex);
                return;
            }
            
            // Пробуем загрузить из markdown файлов
            console.log('Попытка загрузить из markdown файла...');
            const article = await loadMarkdownArticle(articleId);
            
            if (article) {
                console.log('Статья успешно загружена!');
                updateSEO(article);
                document.getElementById('article-title').textContent = article.title;
                document.getElementById('article-description').textContent = article.description;
                document.getElementById('article-content').innerHTML = article.content;
                markLessonAsViewed(articleId);
                if (currentIndex >= 0) updateLessonNav(currentIndex);
                console.log('Статья отображена на странице');
            } else {
                console.error('Не удалось загрузить статью:', articleId);
                document.getElementById('article-title').textContent = 'Статья не найдена';
                document.getElementById('article-content').innerHTML = `
                    <div class="warning-box">
                        <h4><i class="fas fa-exclamation-triangle"></i> Ошибка</h4>
                        <p>Статья "${articleId}" не найдена.</p>
                        <p>Проверьте консоль браузера для получения дополнительной информации.</p>
                    </div>
                    <p style="text-align: center; margin-top: 30px;">
                        <a href="learn.html" class="btn btn-primary">
                            <i class="fas fa-graduation-cap"></i> Вернуться к учебнику
                        </a>
                    </p>
                `;
            }
            console.log('=== КОНЕЦ ЗАГРУЗКИ СТАТЬИ ===');
        }

        function renderQuiz(quizQuestions) {
            const html = '<div class="test-section"><h3><i class="fas fa-clipboard-check"></i> Проверьте свои знания</h3>' +
                quizQuestions.map((q, i) => '<div class="quiz-question" data-index="' + i + '"><p>' + (i+1) + '. ' + q.question + '</p>' +
                q.options.map((opt, j) => '<div class="quiz-option" data-answer="' + j + '"><label>' + opt + '</label></div>').join('') +
                '<div class="quiz-explanation" id="exp' + i + '"></div></div>').join('') + '</div>';
            document.getElementById('article-content').insertAdjacentHTML('beforeend', html);
            
            quizQuestions.forEach((q, i) => {
                document.querySelectorAll('.quiz-question[data-index="' + i + '"] .quiz-option').forEach(opt => {
                    opt.addEventListener('click', function() {
                        const selected = parseInt(this.dataset.answer);
                        const exp = document.getElementById('exp' + i);
                        this.parentNode.querySelectorAll('.quiz-option').forEach(o => { o.classList.remove('correct', 'incorrect'); });
                        if (selected === q.correct) {
                            this.classList.add('correct');
                            exp.className = 'quiz-explanation show correct';
                            exp.innerHTML = '<i class="fas fa-check-circle"></i> Правильно! ' + q.explanation;
                        } else {
                            this.classList.add('incorrect');
                            this.parentNode.querySelectorAll('.quiz-option')[q.correct].classList.add('correct');
                            exp.className = 'quiz-explanation show incorrect';
                            exp.innerHTML = '<i class="fas fa-times-circle"></i> Неправильно. ' + q.explanation;
                        }
                    });
                });
            });
        }

        function markLessonAsViewed(lessonId) {
            try {
                const viewed = JSON.parse(localStorage.getItem('viewedLessons') || '[]');
                if (!viewed.includes(lessonId)) {
                    viewed.push(lessonId);
                    localStorage.setItem('viewedLessons', JSON.stringify(viewed));
                    // Обновляем прогресс
                    if (typeof updateProgress === 'function') {
                        updateProgress();
                    }
                }
            } catch(e) {}
        }

        document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
            document.querySelector('.main-nav').classList.toggle('active');
        });

        loadArticle();
    </script>
</body>
</html>

