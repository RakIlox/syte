# Оценка уязвимостей

## Введение в оценку уязвимостей

Оценка уязвимостей (Vulnerability Assessment) — это систематический процесс выявления, классификации и приоритизации уязвимостей в компьютерных системах. В отличие от пентестинга, который направлен на практическую эксплуатацию уязвимостей, оценка уязвимостей фокусируется на их обнаружении и документировании.

## Классификация уязвимостей

### По происхождению

**Программные уязвимости:**
- Переполнение буфера (Buffer Overflow)
- Внедрение кода (Code Injection)
- Небезопасная десериализация
- Ошибки логики приложения

**Конфигурационные уязвимости:**
- Слабые пароли
- Открытые порты и сервисы
- Неправильные права доступа
- Отсутствие обновлений

**Архитектурные уязвимости:**
- Слабая сегментация сети
- Отсутствие защиты периметра
- Неправильное хранение данных
- Недостаточное логирование

### По степени опасности (CVSS)

Система CVSS (Common Vulnerability Scoring System) оценивает уязвимости от 0 до 10:

| Уровень | Диапазон | Описание |
|---------|----------|----------|
| Критический | 9.0-10.0 | Немедленная угроза, возможна удалённая эксплуатация |
| Высокий | 7.0-8.9 | Серьёзная угроза, сложная эксплуатация |
| Средний | 4.0-6.9 | Умеренная угроза |
| Низкий | 0.1-3.9 | Минимальная угроза |
| Нет | 0.0 | Нет риска |

**Компоненты CVSS:**

```
Base Score = roundup(minimum((Impact + Exploitability), 10))

Impact (Влияние):
- Confidentiality (Конфиденциальность)
- Integrity (Целостность)
- Availability (Доступность)

Exploitability (Эксплуатируемость):
- Attack Vector (Вектор атаки)
- Attack Complexity (Сложность атаки)
- Privileges Required (Требуемые привилегии)
- User Interaction (Взаимодействие пользователя)
```

### По типу (CWE)

CWE (Common Weakness Enumeration) — систематизированный список типов уязвимостей:

- **CWE-79** — Cross-site Scripting (XSS)
- **CWE-89** — SQL Injection
- **CWE-200** — Exposure of Sensitive Information
- **CWE-352** — Cross-Site Request Forgery (CSRF)
- **CWE-434** — Unrestricted Upload of File
- **CWE-502** — Deserialization of Untrusted Data
- **CWE-787** — Out-of-bounds Write
- **CWE-79** — Incorrect Authorization

## Сканеры уязвимостей

### Автоматические сканеры

**Nessus**

Профессиональный сканер уязвимостей от Tenable.

```bash
# Установка и запуск (Enterprise)
# Базовое сканирование
nessuscli scan --name "Network Scan" --target 192.168.1.0/24 --policy "Basic Network Scan"

# Сканирование веб-приложений
nessuscli scan --name "Web App Scan" --target http://example.com --policy "Web Application Tests"
```

**Возможности Nessus:**
- Более 100,000 плагинов
- Сканирование сети, веб-приложений, баз данных
- Проверка конфигурации
- Соответствие стандартам (PCI DSS, HIPAA)
- Детальные отчёты

**OpenVAS**

Открытый сканер уязвимостей.

```bash
# Запуск OpenVAS
openvas-start

# Командная строка
omp -u admin -w password -h localhost -p 9390 \
    --xml="<create_task><name>Scan</name><config id='...'/><target id='...'/></create_task>"
```

**Qualys**

Облачный сканер для корпоративного использования.

**Nikto**

Бесплатный сканер веб-уязвимостей:

```bash
# Базовое сканирование
nikto -h http://example.com

# С агрессивным режимом
nikto -h http://example.com -Tuning x

# С прокси
nikto -h http://example.com -useproxy http://proxy:8080
```

**Nuclei**

Быстрый сканер на основе шаблонов:

```bash
# Сканирование с CVE шаблонами
nuclei -u http://example.com -t cves/

# С технологическими шаблонами
nuclei -u http://example.com -t technologies/

# С файрволом (задержка)
nuclei -u http://example.com -t cves/ -rate-limit 100 -delay 100ms
```

### Специализированные сканеры

**Для веб-приложений:**
- OWASP ZAP
- Burp Suite
- Acunetix
- Netsparker

**Для баз данных:**
- SQLMap
- Havij
- DB Visualizer

**Для сетей:**
- OpenVAS
- Nessus
- Qualys

## Ручной анализ уязвимостей

### OWASP Top 10 (2021)

**A01:2021 – Broken Access Control**

```python
# Уязвимый код (Python/Flask)
@app.route('/api/user/<username>')
def get_user(username):
    user = User.query.filter_by(username=username).first()
    return jsonify(user)  # Нет проверки прав доступа

# Безопасный код
@app.route('/api/user/<username>')
@login_required
def get_user(username):
    if current_user.username != username and not current_user.is_admin:
        abort(403)
    user = User.query.filter_by(username=username).first()
    return jsonify(user)
```

**A02:2021 – Cryptographic Failures**

```javascript
// Плохо: Хранение паролей в открытом виде
const user = {
  username: 'john',
  password: 'password123'  // ОПАСНО!
};

// Хорошо: Хеширование с bcrypt
const bcrypt = require('bcrypt');
const hash = await bcrypt.hash(password, 12);

// Хорошо: Использование современных алгоритмов
const crypto = require('crypto');
const hash = crypto.pbkdf2Sync(password, salt, 100000, 64, 'sha512');
```

**A03:2021 – Injection**

```php
// Уязвимый код (SQL Injection)
$user = $_GET['username'];
$query = "SELECT * FROM users WHERE username = '$user'";  // ОПАСНО!
$result = mysqli_query($conn, $query);

// Безопасный код (Prepared Statements)
$user = $_GET['username'];
$stmt = $conn->prepare("SELECT * FROM users WHERE username = ?");
$stmt->bind_param("s", $user);
$stmt->execute();
```

**A04:2021 – Insecure Design**

```javascript
// Проблема: Отсутствие ограничения rate limiting
// Решение
const rateLimit = require('express-rate-limit');
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 минут
  max: 100 // 100 запросов с IP
});
app.use(limiter);
```

**A05:2021 – Security Misconfiguration**

```yaml
# Пример небезопасной конфигурации (Docker)
# Неправильно:
ports:
  - "0.0.0.0:8080:8080"  # Слушать на всех интерфейсах

# Правильно:
ports:
  - "127.0.0.1:8080:8080"  # Только localhost

# Пример небезопасного config.php
# Неправильно:
define('DEBUG', true);  // Режим отладки в продакшене

# Правильно:
define('DEBUG', false);
```

### Проверка конфигурации

**Проверка SSL/TLS:**

```bash
# testssl.sh
testssl --jsonfile=report.json https://example.com

# SSLyze
sslyze --regular example.com

# OpenSSL
openssl s_client -connect example.com:443
openssl s_client -connect example.com:443 -tls1_2
```

**Проверка HTTP заголовков:**

```bash
# curl
curl -I https://example.com

# Security Headers (онлайн)
# https://securityheaders.com

# Nmap скрипт
nmap --script=http-headers example.com
```

**Проверка SSH:**

```bash
# ssh-audit
ssh-audit example.com

# Nmap
nmap --script=ssh2-enum-algos example.com
```

## Приоритизация уязвимостей

### Матрица рисков

| Влияние / Вероятность | Низкое | Среднее | Высокое |
|----------------------|--------|---------|---------|
| Критическое | Средний | Высокий | Критический |
| Высокое | Низкий | Средний | Высокий |
| Среднее | Низкий | Низкий | Средний |
| Низкое | Низкий | Низкий | Низкий |

### Факторы для оценки

1. **Возможность эксплуатации (Exploitability)**
   - Есть ли публичный эксплойт?
   - Насколько сложна эксплуатация?
   - Требуется ли аутентификация?

2. **Влияние (Impact)**
   - Какие данные могут быть скомпрометированы?
   - Какой ущерб для бизнеса?
   - Есть ли влияние на доступность?

3. **Стоимость устранения (Remediation Cost)**
   - Требуется ли обновление архитектуры?
   - Какова стоимость downtime?
   - Нужен ли re-coding?

## Составление отчёта об уязвимостях

### Структура отчёта

```
1. Резюме для руководства
   - Количество уязвимостей по критичности
   - Общий уровень риска
   - Ключевые рекомендации

2. Методология
   - Использованные инструменты
   - Охват тестирования
   - Ограничения

3. Детальный список уязвимостей
   - Название и ID (CVE, CWE)
   - Описание
   - Уровень критичности (CVSS)
   - Подтверждение (PoC)
   - Влияние
   - Рекомендации по устранению
   - Ссылки

4. Приложения
   - Скриншоты
   - Логи сканирования
   - Исходные данные
```

### Пример описания уязвимости

```
ID: VULN-001
Название: SQL Injection в форме поиска
CVE: N/A
CWE: CWE-89
CVSS: 8.6 (High)

Описание:
Обнаружена SQL-инъекция в параметре "search" формы поиска на странице
/products. Введённые данные не проходят надлежащую валидацию и могут быть
использованы для выполнения произвольных SQL-закросов к базе данных.

Подтверждение:
GET /products?search=test' OR '1'='1 HTTP/1.1
Host: example.com

Ответ сервера содержит все записи из таблицы products, что подтверждает
успешную эксплуатацию SQL-инъекции.

Влияние:
- Злоумышленник может извлечь любые данные из базы данных
- Возможно получение учётных данных пользователей
- Потенциальное удаление или модификация данных

Рекомендации:
1. Используйте подготовленные запросы (prepared statements)
2. Примените ORM с параметризованными запросами
3. Валидируйте входные данные
4. Примените принцип наименьших привилегий для БД

Приоритет: Высокий
Срок устранения: 7 дней
```

## Практические задания

1. Установите Nessus или OpenVAS и просканируйте свою тестовую сеть
2. Используйте OWASP ZAP для анализа уязвимостей веб-приложения
3. Найдите и исправьте уязвимости в уязвимом веб-приложении DVWA
4. Проведите аудит конфигурации SSH на сервере
5. Создайте отчёт об уязвимостях по результатам сканирования

## Выводы

Оценка уязвимостей — это регулярный процесс, требующий комбинации автоматических и ручных методов. Не полагайтесь только на сканеры — они находят только известные уязвимости. Регулярно обновляйте инструменты и базы уязвимостей, правильно приоритизируйте риски и создавайте понятные отчёты для всех заинтересованных сторон.

---

**Следующий урок:** Техники эксплуатации — как практически использовать найденные уязвимости.

