# Управление уязвимостями (Vulnerability Management)

## Введение

Управление уязвимостями — это систематический процесс обнаружения, оценки, приоритизации и устранения уязвимостей в инфраструктуре.

## Жизненный цикл VM

```markdown
## Этапы управления уязвимостями

1. **Discovery** — инвентаризация активов
2. **Assessment** — сканирование уязвимостей
3. **Prioritization** — приоритизация по риску
4. **Remediation** — устранение уязвимостей
5. **Verification** — проверка исправлений
6. **Reporting** — отчётность
```

## Сканирование уязвимостей

```bash
# Nessus
nessuscli scan --name "Full Scan" --targets 192.168.1.0/24 \
    --policy "Basic Network Scan"

# OpenVAS
omp -u admin -w password -h localhost \
    --xml="<create_task><name>Full Scan</name><config id='Full and fast'/><targets><target><name>Local Network</name><hosts>192.168.1.0/24</hosts></target></targets></create_task>"

# Qualys
curl -u "user:password" \
    "https://qualysapi.qualys.com/api/2.0/fo/scan/"
```

## CVSS и приоритизация

```python
import cvss

def calculate_risk_score(vulnerability):
    """Расчёт риска с учётом CVSS и контекста"""
    
    # Базовый CVSS score
    base_score = vulnerability.cvss_score
    
    # Модификаторы
    exploit_available = vulnerability.has_exploit_kit  # +0.5
    in_wild = vulnerability.active_in_wild  # +0.3
    public_exploit = vulnerability.public_exploit  # +0.4
    
    # Контекстные факторы
    if vulnerability.is_external_facing:
        base_score *= 1.2
    if vulnerability.affects_critical_system:
        base_score *= 1.3
    if vulnerability.has_data_exposure:
        base_score *= 1.4
    
    return min(base_score, 10.0)
```

## Vulnerability Metrics

```python
VM_METRICS = {
    'critical_count': 'Критические уязвимости',
    'high_count': 'Высокие уязвимости',
    'avg_time_to_patch': 'Среднее время исправления',
    'vulnerability_age': 'Возраст уязвимостей',
    'scan_coverage': 'Покрытие сканированием',
    'sla_compliance': 'Соответствие SLA'
}

# SLA для исправления
PATCH_SLA = {
    'critical': 7,   # 7 дней
    'high': 14,      # 14 дней
    'medium': 30,    # 30 дней
    'low': 90        # 90 дней
}
```

## Отчётность

```markdown
## Monthly Vulnerability Report

### Executive Summary
| Metric | Value | Trend |
|--------|-------|-------|
| Total Vulnerabilities | 156 | ↓ 12% |
| Critical | 3 | → 0 |
| High | 18 | ↓ 5 |
| SLA Compliance | 94% | ↑ 3% |

### Top 5 Affected Systems
1. WEB-SRV-01 (Critical: 2, High: 8)
2. DB-SRV-02 (Critical: 1, High: 6)
3. APP-SRV-03 (Critical: 0, High: 5)

### Recommendations
1. Приоритизировать исправление CVE-2024-XXXX
2. Пересмотреть политику patch management
3. Улучшить coverage для Linux систем
```

## Best Practices

1. Сканировать регулярно (еженедельно/ежемесячно)
2. Использовать authenticated сканирование
3. Интегрировать с SIEM
4. Автоматизировать patch deployment
5. Внедрить risk-based приоритизацию
6. Регулярно пересматривать SLA

